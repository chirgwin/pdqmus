var pdqmus={};pdqmus.Sound=function(){this.id=null};pdqmus.Sound.prototype.play=function(){throw"not implemented";};pdqmus.Sound.prototype.pause=function(){throw"not implemented";};pdqmus.Sound.prototype.clone=function(){throw"not implemented";};pdqmus.Notation=function(a,b,c,g){this.onset=a;this.duration=b;this.onsetMetric=c;this.durationMetric=g};pdqmus.Notation.prototype.durationFromMetric=function(a){this.duration=60/a*this.durationMetric};pdqmus.Notation.prototype.onsetFromMetric=function(a){this.onset=60/a*this.onsetMetric};pdqmus.Notation.prototype.convertFromMetric=function(a){this.durationFromMetric(a);this.onsetFromMetric(a)};
pdqmus.Notation.prototype.getNearestNotelistDur=function(a){a||(a=60);for(var b=0,c=9999,g=0;g<pdqmus.Note.METRIC_DURATIONS.length;g++){var m=Math.abs(pdqmus.Note.METRIC_DURATIONS[g]-this.duration*(a/60));if(m<c){c=m;b=g}}return b};pdqmus.Notation.sortByDurationDesc=function(a,b){if(a.duration>b.duration)return-1;else if(a.duration<b.duration)return 1;return 0};pdqmus.Notation.sortByOnset=function(a,b){if(a.onset<b.onset)return-1;else if(a.onset>b.onset)return 1;return 0};
pdqmus.Notation.generateNotelist=function(a,b){var c=0;b||(b=60);for(var g="%%Notelist-V2 file='exported from pdqm.us'  partstaves=1 0 startmeas=1"+pdqmus.Util.NEWLINE+"C stf=1 type=3"+pdqmus.Util.NEWLINE+"K stf=1 KS=0 #"+pdqmus.Util.NEWLINE+"M stf=1 '' q="+b+pdqmus.Util.NEWLINE,m=0;m<a.length;m++){var p=a[m],t=Math.round(p.duration*pdqmus.Note.NOTELIST_TICKS_PER_QUARTER);g+="N t="+c+" v=1 npt=1 stf=1 dur="+p.getNearestNotelistDur(b)+" dots=0 nn="+p.noteNum+" acc=0 eAcc=0 pDur="+t*0.9+" vel=75 ...... appear=1"+
pdqmus.Util.NEWLINE;c+=t}g+="/ t="+c+" type=1"+pdqmus.Util.NEWLINE;return g};pdqmus.Notation.NOTELIST_TICKS_PER_QUARTER=480;pdqmus.Notation.NOTELIST_DURATIONS=["longa","breve","whole","half","quarter","eighth","16th","32nd","64th","128th"];pdqmus.Notation.METRIC_DURATIONS=[16,8,4,2,1,0.5,0.25,0.125,0.0625,0.03125];pdqmus.Api=function(){};pdqmus.Api.musicXmlFromNotes=function(a,b,c){b=new pdqmus.AsynchRequest(b,"POST");b.errorCallback=c;a.sort(pdqmus.Notation.sortByOnset);b.requestData=pdqmus.Notation.generateNotelist(a);b.loadXml("/nl2xml")};
pdqmus.Api.soundingStoneRowGen=function(a,b,c){if(a.length!=3)throw"must have 3 numeric pitch classes, no more, no less";for(var g=pdqmus.Api.PROXY_URL+"http://www.soundingstone.net/cgi-bin/rowgen.cgi?mode=json",m=0;m<3;m++)g+="&pitchlist="+a[m];a=new pdqmus.AsynchRequest(b);a.errorCallback=c;a.loadJson(g)};pdqmus.Api.sappHenon=function(a,b){var c=pdqmus.Api.PROXY_URL+"http://henon.sapp.org/cgi-bin/henonsequence",g=new pdqmus.AsynchRequest(a,"POST");g.parseJsonResponse=false;g.errorCallback=b;g.loadJson(c)};
pdqmus.Api.PROXY_URL="/proxy?";pdqmus.Api.formUrl=function(a,b){var c=0,g;for(g in b){a+=c==0?"?":"&";a+=g+"="+b[g];c++}return a};pdqmus.Api.loadJsonp=function(a){var b=document.createElement("script");b.type="text/javascript";b.src=a;document.getElementsByTagName("head")[0].appendChild(b)};pdqmus.AsynchRequest=function(a,b){this.data=this.string=null;this.xmlHttp=pdqmus.XmlHttpRequest.create();this.requestData=this.requestObj=this.errorCallback=null;this.parseJsonResponse=true;this.loadedCallback=a?a:null;this.method=b?b:"GET"};
pdqmus.AsynchRequest.prototype.loadJson=function(a){var b=this;this.xmlHttp.overrideMimeType(XmlHttpRequest.CONTENT_TYPE_JSON);this.xmlHttp.open(this.method,a,true);this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_ACCEPT,pdqmus.XmlHttpRequest.CONTENT_TYPE_JSON);this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_REQUESTED_WITH,pdqmus.XmlHttpRequest.REQUESTED_WITH_TYPE);this.xmlHttp.onreadystatechange=function(){if(b.xmlHttp.readyState==pdqmus.XmlHttpRequest.READYSTATE_COMPLETE){b.string=b.xmlHttp.responseText;
try{if(b.parseJsonResponse)b.data=JSON.parse(b.string);if(XmlHttpRequest.SUCCESS_STATUSES.indexOf(b.xmlHttp.status)>=0){if(b.loadedCallback!=null)b.data?b.loadedCallback(b.data):b.loadedCallback(b.string)}else b.errorCallback!=null&&b.errorCallback()}catch(c){b.errorCallback!=null&&b.errorCallback({error:c,response:b.xmlHttp.responseText,status:b.xmlHttp.status})}}};if(this.requestObj){this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_CONTENT_TYPE,pdqmus.XmlHttpRequest.CONTENT_TYPE_JSON);this.requestData=
JSON.stringify(this.requestObj)}this.xmlHttp.send(this.requestData)};
pdqmus.AsynchRequest.prototype.loadXml=function(a){var b=this;this.xmlHttp.overrideMimeType(XmlHttpRequest.CONTENT_TYPE_XML);this.xmlHttp.open(this.method,a,true);this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_ACCEPT,pdqmus.XmlHttpRequest.CONTENT_TYPE_XML);this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_REQUESTED_WITH,pdqmus.XmlHttpRequest.REQUESTED_WITH_TYPE);this.xmlHttp.onreadystatechange=function(){if(b.xmlHttp.readyState==pdqmus.XmlHttpRequest.READYSTATE_COMPLETE){b.string=b.xmlHttp.responseText.replace('<?xml version="1.0" encoding="UTF-8"?>',
"");try{b.data=b.xmlHttp.responseXML;if(XmlHttpRequest.SUCCESS_STATUSES.indexOf(b.xmlHttp.status)>=0){if(b.loadedCallback!=null)b.data?b.loadedCallback(b.data):b.loadedCallback(b.string)}else b.errorCallback!=null&&b.errorCallback()}catch(c){b.errorCallback!=null&&b.errorCallback({error:c,response:b.xmlHttp.responseText,status:b.xmlHttp.status})}}};this.xmlHttp.send(this.requestData)};pdqmus.AsynchRequest.prototype.cancelCallback=function(){this.loadedCallback=null};pdqmus.AudioSequence=function(a,b,c,g){function m(d){pdqmus.Sample.createFromUrl(d.audioDataUrl).play()}function p(){var d=((new Date).getTime()-l)/1E3;if(o.length>0&&o[0].notes[0].onset<=d-pdqmus.AudioSequence.BUFFER_DELAY){if(!C){j&&j();C=true}if(o.length<=1&&B)h=true;setTimeout(m,1,o.shift())}if(q.length>0&&q[0].onset<=d+k){d=q.shift();for(var s=[d],w=1;w<q.length;w++)if(q[w].onset==d.onset)s.push(q.shift());else if(q[w].onset>d.onset)break;d=new pdqmus.RenderWaveMessage([d],r,y);v.postMessage(d)}if(q.length<=
0)B=true;if(h)u&&u();else x=setTimeout(p,t)}var t=10,x,l,o=[],k=2,z=a.clone(),q,r=b,y=c||null,h=false,C=false,B=false,D=new pdqmus.Wave,f=true,j=null,u=null,A=this,v;if(window.Worker){v=g?new Worker(g+"/wave_render_worker.js"):new Worker("wave_render_worker.js");v.onmessage=function(d){o.push(d.data)};v.onerror=function(d){throw d;}}this.drawWaveform=function(){return A.getAggregateWave().draw()};this.getDataUrl=function(){return A.getAggregateWave().getDataUrl()};this.getAggregateWave=function(){if(f){for(var d=
0;d<z.length;d++){var s=z[d];D.render(pdqmus.Note.frequencyFromMidiNote(s.noteNum),s.duration,pdqmus.Note.midiVelocityToAmplitude(s.velocity),b);c&&D.envelope(y)}f=false}return D};this.pause=function(){throw"unimplemented";};this.stop=function(){v&&v.terminate();clearTimeout(x);u&&u()};this.play=function(d){if(d){l=new Date;q=z.clone();q.sort(pdqmus.Notation.sortByOnset);setTimeout(p,1)}else pdqmus.Sample.createFromUrl(A.getDataUrl()).play()};this.setStartCallback=function(d){j=d};this.setFinishCallback=
function(d){u=d}};pdqmus.AudioSequence.BUFFER_DELAY=0.3;pdqmus.Barline=function(a,b,c){this.onset=a;this.type=b||pdqmus.Barline.TYPE_NORMAL;this.onsetMetric=c;this.duration=0};pdqmus.Barline.prototype=new pdqmus.Notation;pdqmus.Barline.prototype.clone=function(){return new pdqmus.Barline(this.onset,this.type,this.onsetMetric)};pdqmus.Barline.TYPE_NORMAL="normal";var Base64={};Base64.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
Base64.encode=function(a,b){var c,g,m,p,t=[],x="",l,o,k=Base64.code;o=(typeof b=="undefined"?false:b)?Utf8.encode(a):a;l=o.length%3;if(l>0)for(;l++<3;){x+="=";o+="\u0000"}for(l=0;l<o.length;l+=3){c=o.charCodeAt(l);g=o.charCodeAt(l+1);m=o.charCodeAt(l+2);p=c<<16|g<<8|m;c=p>>18&63;g=p>>12&63;m=p>>6&63;p=p&63;t[l/3]=k.charAt(c)+k.charAt(g)+k.charAt(m)+k.charAt(p)}t=t.join("");return t=t.slice(0,t.length-x.length)+x};
Base64.decode=function(a,b){b=typeof b=="undefined"?false:b;var c,g,m,p,t,x=[],l,o=Base64.code;l=b?Utf8.decode(a):a;for(var k=0;k<l.length;k+=4){c=o.indexOf(l.charAt(k));g=o.indexOf(l.charAt(k+1));p=o.indexOf(l.charAt(k+2));t=o.indexOf(l.charAt(k+3));m=c<<18|g<<12|p<<6|t;c=m>>>16&255;g=m>>>8&255;m=m&255;x[k/4]=String.fromCharCode(c,g,m);if(t==64)x[k/4]=String.fromCharCode(c,g);if(p==64)x[k/4]=String.fromCharCode(c)}p=x.join("");return b?Utf8.decode(p):p};var Utf8={};
Utf8.encode=function(a){a=a.replace(/[\u0080-\u07ff]/g,function(b){b=b.charCodeAt(0);return String.fromCharCode(192|b>>6,128|b&63)});return a=a.replace(/[\u0800-\uffff]/g,function(b){b=b.charCodeAt(0);return String.fromCharCode(224|b>>12,128|b>>6&63,128|b&63)})};
Utf8.decode=function(a){a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(b){b=(b.charCodeAt(0)&31)<<6|b.charCodeAt(1)&63;return String.fromCharCode(b)});return a=a.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(b){b=(b.charCodeAt(0)&15)<<12|(b.charCodeAt(1)&63)<<6|b.charCodeAt(2)&63;return String.fromCharCode(b)})};pdqmus.Clef=function(a,b,c,g){this.onset=a;this.sign=b;this.line=c;this.onsetMetric=g;this.duration=0};pdqmus.Clef.prototype=new pdqmus.Notation;pdqmus.Clef.prototype.clone=function(){return new pdqmus.Clef(this.onset,this.sign,this.line,this.onsetMetric)};pdqmus.EchoNest=function(a){this.apiKey=a;this.errorCallback=this.loadedCallback=null;this.method="GET";this.result=null;this.useJsonp=false;var b=this;this.call=function(c,g,m,p){var t=new pdqmus.AsynchRequest(p);if(b.errorCallback)t.errorCallback=b.errorCallback;var x={};x.api_key=this.apiKey;for(var l in m)x[l]=m[l];if(b.useJsonp){x.format="jsonp";x.callback=p;c=pdqmus.Api.formUrl("http://developer.echonest.com/api/v4/"+c+"/"+g,x);pdqmus.Api.loadJsonp(c)}else{x.format="json";c=pdqmus.Api.formUrl(pdqmus.Api.PROXY_URL+
"http://developer.echonest.com/api/v4/"+c+"/"+g,x);t.loadJson(c)}}};pdqmus.GeneralMidi=function(){};
pdqmus.GeneralMidi.PATCHES=["","Acoustic Grand Piano","Bright Acoustic Piano","Electric Grand Piano","Honky-tonk Piano","Electric Piano 1","Electric Piano 2","Harpsichord","Clavinet","Celesta","Glockenspiel","Music Box","Vibraphone","Marimba","Xylophone","Tubular Bells","Dulcimer","Drawbar Organ","Percussive Organ","Rock Organ","Church Organ","Reed Organ","Accordion","Harmonica","Tango Accordion","Acoustic Guitar (nylon)","Acoustic Guitar (steel)","Electric Guitar (jazz)","Electric Guitar (clean)",
"Electric Guitar (muted)","Overdriven Guitar","Distortion Guitar","Guitar harmonics","Acoustic Bass","Electric Bass (finger)","Electric Bass (pick)","Fretless Bass","Slap Bass 1","Slap Bass 2","Synth Bass 1","Synth Bass 2","Violin","Viola","Cello","Contrabass","Tremolo Strings","Pizzicato Strings","Orchestral Harp","Timpani","String Ensemble 1","String Ensemble 2","Synth Strings 1","Synth Strings 2","Choir Aahs","Voice Oohs","Synth Voice","Orchestra Hit","Trumpet","Trombone","Tuba","Muted Trumpet",
"French Horn","Brass Section","Synth Brass 1","Synth Brass 2","Soprano Sax","Alto Sax","Tenor Sax","Baritone Sax","Oboe","English Horn","Bassoon","Clarinet","Piccolo","Flute","Recorder","Pan Flute","Blown Bottle","Shakuhachi","Whistle","Ocarina","Lead 1 (square)","Lead 2 (sawtooth)","Lead 3 (calliope)","Lead 4 (chiff)","Lead 5 (charang)","Lead 6 (voice)","Lead 7 (fifths)","Lead 8 (bass + lead)","Pad 1 (new age)","Pad 2 (warm)","Pad 3 (polysynth)","Pad 4 (choir)","Pad 5 (bowed)","Pad 6 (metallic)",
"Pad 7 (halo)","Pad 8 (sweep)","FX 1 (rain)","FX 2 (soundtrack)","FX 3 (crystal)","FX 4 (atmosphere)","FX 5 (brightness)","FX 6 (goblins)","FX 7 (echoes)","FX 8 (sci-fi)","Sitar","Banjo","Shamisen","Koto","Kalimba","Bag pipe","Fiddle","Shanai","Tinkle Bell","Agogo","Steel Drums","Woodblock","Taiko Drum","Melodic Tom","Synth Drum","Reverse Cymbal","Guitar Fret Noise","Breath Noise","Seashore","Bird Tweet","Telephone Ring","Helicopter","Applause","Gunshot"];pdqmus.KeySignature=function(a,b,c){this.onset=a;this.fifths=b;this.mode=c;this.duration=0};pdqmus.KeySignature.prototype=new pdqmus.Notation;pdqmus.KeySignature.prototype.clone=function(){return new pdqmus.KeySignature(this.onset,this.fifths,this.mode,this.onsetMetric)};pdqmus.KeySignature.MODE_MAJOR="major";pdqmus.KeySignature.MODE_MINOR="minor";pdqmus.Midi=function(a,b){function c(l){for(var o=0,k=0,z="",q=0;q<l.length;q++){k=Math.round(l[q].onset*m/60*g);z+=pdqmus.Util.strFromVariableInt(k-o);z+=l[q].write();o=k}return z}var g=480,m=b||120,p="",t="",x=a||1;this.addTrack=function(l,o,k){o>=0||(o=0);k>=0||(o=0);k=pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(192+o)+pdqmus.Util.strFromByte(k)+pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(4)+pdqmus.Util.strFromByte(25)+"Contrabass Ukulelephonium";for(var z=
[],q=0;q<l.length;q++){var r=l[q];z.push(new pdqmus.MidiNote(q,r.onset,9,o,r.noteNum,r.velocity));z.push(new pdqmus.MidiNote(q,r.onset+r.duration,8,o,r.noteNum,0))}z.sort(pdqmus.Notation.sortByOnset);k+=c(z)+pdqmus.Util.strFromVariableInt(Math.round(g/10))+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(47)+pdqmus.Util.strFromByte(0);t+="MTrk"+pdqmus.Util.strFromDword(k.length,pdqmus.Util.BIG_ENDIAN)+k};this.getDataUrl=function(){return"data:"+pdqmus.Midi.MIME_TYPE+";base64,"+btoa(p+t)};p="MThd"+
pdqmus.Util.strFromDword(6,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromWord(1,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromWord(x+1,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromWord(g,pdqmus.Util.BIG_ENDIAN);(function(){var l=Math.round(6E7/m);l=pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(81)+pdqmus.Util.strFromByte(3)+pdqmus.Util.strFromByte(l>>16)+pdqmus.Util.strFromByte(l>>8)+pdqmus.Util.strFromByte(l)+pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(3)+
pdqmus.Util.strFromByte(26)+"MIDI Created by Javascript"+pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(2)+pdqmus.Util.strFromByte(42)+"Copyleft, Music Hack Day Boston 2010 rules";messages=[];messages.push(new pdqmus.MidiKeySignature(0,0,0));messages.push(new pdqmus.MidiTimeSignature(1,0,4,4));l+=c(messages)+pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(47)+pdqmus.Util.strFromByte(0);t+="MTrk"+pdqmus.Util.strFromDword(l.length,pdqmus.Util.BIG_ENDIAN)+
l})()};pdqmus.Midi.prototype.play=function(){pdqmus.MidiSound.createFromUrl(this.getDataUrl()).play()};pdqmus.MidiMessage=function(a,b,c){this.index=a;this.onset=b;this.statusCode=c};pdqmus.MidiNote=function(a,b,c,g,m,p){this.index=a;this.onset=b;this.statusCode=c;this.channel=g;this.noteNum=m;this.velocity=p};pdqmus.MidiNote.prototype=new pdqmus.MidiMessage;
pdqmus.MidiNote.prototype.write=function(){return pdqmus.Util.strFromByte(this.statusCode*16+this.channel,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromByte(this.noteNum,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromByte(this.velocity,pdqmus.Util.BIG_ENDIAN)};pdqmus.MidiKeySignature=function(a,b,c){this.index=a;this.onset=b;this.statusCode=89;this.fifths=c;this.mode=0};pdqmus.MidiKeySignature.prototype=new pdqmus.MidiMessage;
pdqmus.MidiKeySignature.prototype.write=function(){return pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(this.statusCode)+pdqmus.Util.strFromByte(2)+pdqmus.Util.strFromByte(this.fifths)+pdqmus.Util.strFromByte(this.mode)};pdqmus.MidiTimeSignature=function(a,b,c,g){this.index=a;this.onset=b;this.statusCode=88;this.numerator=c;this.denominator=g;this.pulse=24;this.thirtySecondsPerPulse=8};pdqmus.MidiTimeSignature.prototype=new pdqmus.MidiMessage;
pdqmus.MidiTimeSignature.prototype.write=function(){return pdqmus.Util.strFromByte(255,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromByte(this.statusCode)+pdqmus.Util.strFromByte(4)+pdqmus.Util.strFromByte(this.numerator)+pdqmus.Util.strFromByte(Math.round(Math.log(this.denominator)/Math.LN2))+pdqmus.Util.strFromByte(this.pulse)+pdqmus.Util.strFromByte(this.thirtySecondsPerPulse)};pdqmus.Midi.MIME_TYPE="audio/mid";pdqmus.MidiSound=function(){this.domRef=document.createElement("embed");this.parentRef=document.getElementsByTagName("body")[0]};pdqmus.MidiSound.prototype=new pdqmus.Sound;pdqmus.MidiSound.prototype.play=function(){this.domRef.hidden="true";this.domRef.autoplay="true";this.domRef.autostart="True";this.domRef.loop="false";this.domRef.volume="100%";this.domRef.style.visibility="hidden";this.parentRef.appendChild(this.domRef)};pdqmus.MidiSound.prototype.pause=function(){this.destroy()};
pdqmus.MidiSound.prototype.destroy=function(){this.domRef.parentNode.removeChild(this.domRef);this.domRef=null};pdqmus.MidiSound.prototype.clone=function(){return pdqmus.MidiSound.createFromUrl(this.url)};pdqmus.MidiSound.createFromUrl=function(a){var b=new pdqmus.MidiSound;b.domRef.src=a;b.domRef.id=pdqmus.Util.guid();return b};pdqmus.Note=function(a,b,c,g,m,p,t){this.onset=a;this.duration=b;this.noteNum=c;this.velocity=g||60;this.onsetMetric=p;this.durationMetric=t;this.isRest=m||false};pdqmus.Note.prototype=new pdqmus.Notation;pdqmus.Note.prototype.clone=function(){return new pdqmus.Note(this.onset,this.duration,this.noteNum,this.velocity,this.isRest)};pdqmus.Note.midiVelocityToAmplitude=function(a){return 1/127*a};pdqmus.Note.midiNoteFromFrequency=function(a){return 12*Math.log2(a/440)+69};
pdqmus.Note.frequencyFromMidiNote=function(a){return pdqmus.Note.CONCERT_A_FREQUENCY/32*Math.pow(2,(a-9)/12)};pdqmus.Note.CONCERT_A_FREQUENCY=440;pdqmus.Note.randomNotes=function(a,b){for(var c=[],g=0,m=0;m<a;m++){var p=Math.random(),t=new pdqmus.Note(g,p*0.9,Math.floor(Math.random()*100)+10,b?Math.floor(Math.random()*40)+10:Math.floor(Math.random()*50)+67);g+=p;c.push(t)}return c};
pdqmus.Note.chromaticSequence=function(a,b,c){var g=0,m=[];for(a=a;a<=b;a++){var p=new pdqmus.Note(g,c,a,60);m.push(p);g+=c}return m};pdqmus.Note.DEFAULT_VELOCITY=60;
pdqmus.Note.MidiFrequencies=[8.1757989156,8.661957218,9.1770239974,10.3008611535,10.3008611535,10.9133822323,11.5623257097,12.2498573744,12.9782717994,13.75,14.5676175474,15.4338531643,16.3515978313,17.3239144361,18.3540479948,19.4454364826,20.6017223071,21.8267644646,23.1246514195,24.4997147489,25.9565435987,27.5,29.1352350949,30.8677063285,32.7031956626,34.6478288721,36.7080959897,38.8908729653,41.2034446141,43.6535289291,46.249302839,48.9994294977,51.9130871975,55,58.2704701898,61.735412657,65.4063913251,
69.2956577442,73.4161919794,77.7817459305,82.4068892282,87.3070578583,92.4986056779,97.9988589954,103.826174395,110,116.5409403795,123.470825314,130.8127826503,138.5913154884,146.8323839587,155.563491861,164.8137784564,174.6141157165,184.9972113558,195.9977179909,207.65234879,220,233.081880759,246.9416506281,261.6255653006,277.1826309769,293.6647679174,311.1269837221,329.6275569129,349.228231433,369.9944227116,391.9954359817,415.3046975799,440,466.1637615181,493.8833012561,523.2511306012,554.3652619537,
587.3295358348,622.2539674442,659.2551138257,698.456462866,739.9888454233,783.9908719635,830.6093951599,880,932.3275230362,987.7666025122,1046.5022612024,1108.7305239075,1174.6590716696,1244.5079348883,1318.5102276515,1396.912925732,1479.9776908465,1567.981743927,1661.2187903198,1760,1864.6550460724,1975.5332050245,2093.0045224048,2217.461047815,2349.3181433393,2489.0158697766,2637.020455303,2793.825851464,2959.9553816931,3135.963487854,3322.4375806396,3520,3729.3100921447,3951.066410049,4186.0090448096,
4434.92209563,4698.6362866785,4978.0317395533,5274.0409106059,5587.6517029281,5919.9107633862,5919.9107633862,6644.8751612791,7040,7458.6201842894,7902.132820098,8372.0180896192,8869.8441912599,9397.272573357,9956.0634791066,10548.0818212118,11175.3034058561,11839.8215267723,12543.853951416];pdqmus.PianoRoll=function(a,b,c,g,m,p){function t(){k.strokeStyle=r;k.moveTo(x,0);k.lineTo(x,o.height);k.stroke();x++;if(x<=l)setTimeout(t,1E3/z);else{h&&o.parentNode.removeChild(o);k.restore()}}this.notes=a;DEFAULT_PITCH_RANGE=127;DEFAULT_UNIT_WIDTH=10;DEFAULT_UNIT_HEIGHT=2;DEFAULT_COLOR="#36c";DEFAULT_CURSOR_COLOR="rgba(200, 100, 50, 0.04)";var x=0,l=0,o=document.createElement("canvas"),k=o.getContext("2d"),z=b||DEFAULT_UNIT_WIDTH,q=c||DEFAULT_UNIT_HEIGHT,r=g||DEFAULT_CURSOR_COLOR,y=m||DEFAULT_PITCH_RANGE,
h=p||false;self=this;this.render=function(C){var B=this.notes[this.notes.length-1];l=(B.onset+B.duration)*z;o.width=l;o.height=q*y;k.strokeStyle=DEFAULT_COLOR;if(C)k.strokeStyle=C;k.lineWidth=q;k.beginPath();for(C=0;C<this.notes.length;C++){var D=this.notes[C];B=D.onset*z;var f=o.height-D.noteNum*q;D=D.duration*z;k.moveTo(B,f);k.lineTo(B+D,f);k.stroke()}k.save();return o};this.play=function(){t()}};
pdqmus.PianoRoll.prototype.draw=function(){var a=this.render();a.style.border="1px solid #352";a.style.padding="10px";document.body.appendChild(a)};pdqmus.Sample=function(){this.domRef=document.createElement("audio");this.domRef.preload=true};pdqmus.Sample.prototype=new pdqmus.Sound;pdqmus.Sample.prototype.play=function(){this.domRef.play()};pdqmus.Sample.prototype.pause=function(){this.domRef.pause()};pdqmus.Sample.prototype.clone=function(){return pdqmus.Sample.createFromUrl(this.url)};pdqmus.Sample.createFromUrl=function(a){var b=new pdqmus.Sample;b.domRef.src=a;b.domRef.id=b.id=pdqmus.Util.guid();return b};pdqmus.Sequencer=function(a,b,c,g){function m(r){r.target.beatOn=!r.target.beatOn;r.target.className=r.target.beatOn?"beatbox beatOn":"beatbox beatOff";if(r.target.isDownbeat)r.target.className+=" downbeat"}var p=pdqmus.Sequencer.SIMPLE_METER,t=a;this.tempo=b||120;this.meterType=c||p;this.numBigBeats=g||4;var x=6E4/this.tempo/this.meterType,l=t.length,o=this.numBigBeats*this.meterType,k=0;this.isPlaying=false;this.isLooping=true;var z;this.allowSampleOverlap=false;var q=this;this.loop=function(){if(k>=
o){k=0;if(!q.isLooping)return}for(var r=0;r<l;r++)for(var y=0;y<o;y++){var h=document.getElementById(r+"_"+y);h.className="beatbox";if(h.isDownbeat)h.className+=" downbeat";h.className+=h.beatOn?" beatOn":" beatOff";if(y==k)h.className+=" beatHighlighted"}for(r=0;r<t.length;r++)if(document.getElementById(r+"_"+k).beatOn)q.allowSampleOverlap?t[r][k].play():t[r][0].play();k++;if(q.isPlaying)z=setTimeout(q.loop,x)};this.render=function(r){for(var y=0;y<l;y++){for(var h=document.createElement("div"),
C=0;C<o;C++){var B=document.createElement("div");B.setAttribute("id",y+"_"+C);B.beatOn=false;B.addEventListener("mousedown",m,"true");if(C>0&&C%this.meterType==0){B.isDownbeat=true;B.className="beatbox beatOff downbeat"}else B.className="beatbox beatOff";h.appendChild(B);h.className="row"}r.appendChild(h)}};this.pauseAllSounds=function(){};this.play=function(){this.isPlaying=true;q.loop()};this.pause=function(){q.isPlaying=false;z&&clearTimeout(z);q.pauseAllSounds()};(function(){for(var r=[],y=0;y<
l;y++){r[y]=[];r[y][0]=t[y];if(q.allowSampleOverlap)for(var h=1;h<o;h++){r[y][h]=t[y].clone();console.log(y,h,r[y][h].id)}}t=r})()};pdqmus.Sequencer.prototype.draw=function(){var a=document.createElement("div");a.className="sequencer";this.render(a);document.body.appendChild(a)};pdqmus.Sequencer.SIMPLE_METER=4;pdqmus.Sequencer.COMPOUND_METER=3;pdqmus.Sequencer.DUPLE_METER=2;pdqmus.Sequencer.SINGLE_METER=1;pdqmus.Tempo=function(a,b,c,g){this.onset=a;this.bpm=b;this.text=c;this.onsetMetric=g;this.duration=0};pdqmus.Tempo.prototype=new pdqmus.Notation;pdqmus.Tempo.prototype.clone=function(){return new pdqmus.Tempo(this.onset,this.bpm,this.text,this.onsetMetric)};pdqmus.TimeSignature=function(a,b,c,g){this.onset=a;this.numerator=b;this.denominator=c;this.onsetMetric=g;this.duration=0};pdqmus.TimeSignature.prototype=new pdqmus.Notation;pdqmus.TimeSignature.prototype.clone=function(){return new pdqmus.KeySignature(this.onset,this.numerator,this.denominator,this.onsetMetric)};pdqmus.Wave=function(){function a(){C=q*z*r/o;B=z*r/o;y=c+pdqmus.Util.strFromDword(h.length+g)+m+p+pdqmus.Util.strFromDword(l)+pdqmus.Util.strFromWord(x)+pdqmus.Util.strFromWord(z)+pdqmus.Util.strFromDword(q)+pdqmus.Util.strFromDword(C)+pdqmus.Util.strFromWord(B)+pdqmus.Util.strFromWord(r)+t+pdqmus.Util.strFromDword(h.length*z*r/o)}function b(){var f="";switch(r){case 8:for(var j=0;j<h.length;j++)f+=String.fromCharCode(Math.round(Math.min(1,Math.max(-1,h[j]))*127+127));break;case 16:for(j=0;j<h.length;j++){var u=
Math.round(Math.min(1,Math.max(-1,h[j]))*32767);if(u<0)u+=k;f+=u}}return f}var c="RIFF",g=36,m="WAVE",p="fmt ",t="data",x=1,l=16,o=8,k=Math.pow(2,22050),z=1,q=22050,r=8,y="",h=[],C=0,B=0,D=[];this.clearData=function(){h=[]};this.setData=function(f){h=f;a()};this.setCycle=function(f){D=f};this.render=function(f,j,u,A){j||(j=1);u||(u=1);if(!A)A=pdqmus.Wave.OSC_DEFAULT;var v=Math.round(1/f*q);pdqmus.Wave.PERIODIC_OSCILLATORS.indexOf(A)>=0||(v*=j*f);var d=[];switch(A){case pdqmus.Wave.OSC_TRIANGLE:d=
v;for(var s=[],w=0;w<d;w++)s.push((Math.abs(w/q%(1/f)*2*f-1)-0.5)*2);d=s;break;case pdqmus.Wave.OSC_SINE:d=v;s=[];for(w=0;w<d;w++)s.push(Math.sin(w/q*2*Math.PI*f));d=s;break;case pdqmus.Wave.OSC_SILENCE:d=v;s=[];for(w=0;w<d;w++)s.push(0);d=s;break;case pdqmus.Wave.OSC_NOISE:d=v;s=[];for(w=0;w<d;w++)s.push((0.5-Math.random())*2);d=s;break;case pdqmus.Wave.OSC_SQUARE:d=v;s=[];for(w=0;w<d;w++)s.push(Math.floor(w/q*2/(1/f)&1)?-1:1);d=s;break;case pdqmus.Wave.OSC_SAWTOOTH:d=v;s=[];for(w=0;w<d;w++)s.push(w/
q%(1/f)*2*f-1);d=s;break;case pdqmus.Wave.OSC_CUSTOM:if(D.length<=0)throw"need cycle data for custom oscillator";}if(u!=1)for(s=0;s<d.length;s++)d[s]*=u;if(pdqmus.Wave.PERIODIC_OSCILLATORS.indexOf(A)>=0)for(s=0;s<Math.round(j*f);s++)h=h.concat(d);else if(A==pdqmus.Wave.OSC_CUSTOM)for(s=0;s<Math.round(v/D.length);s++)h=h.concat(D);else h=h.concat(d);a();D=d};this.getDataUrl=function(f){return f?"data:audio/wav;base64,"+Base64.encode(y+b()):"data:audio/wav;base64,"+btoa(y+b())};this.getData=function(){return h};
this.renderVisual=function(f,j,u,A,v){if(!u)u=pdqmus.Wave.VISUAL_TYPE_DEFAULT;f||(f=100);j||(j=100);A=A?D:h;switch(u){case pdqmus.Wave.VISUAL_TYPE_WAVEFORM:var d=document.createElement("canvas");d.id=pdqmus.Util.guid();d.height=j;d.width=f;u=d.getContext("2d");f=f/A.length;var s=0;j=j/2;u.strokeStyle=v?v:"#000";u.beginPath();u.moveTo(s,j);for(v=0;v<A.length;v++){u.lineTo(s,j*(1-A[v]));s+=f}u.stroke()}return d};this.envelope=function(f){var j=f.a,u=f.d,A=f.s;f=f.r;j*=h.length;u*=h.length;f*=h.length;
for(var v=1-A,d=0;d<j;d++)h[d]*=d/j;for(;d<j+u;d++)h[d]*=(1-(d-j)/u)*v+A;for(;d<h.length-f;d++)h[d]*=A;for(j=d;d<h.length;d++)h[d]*=A*(1-(d-j)/f)};this.filterResonant=function(f,j,u,A){var v=freq*2/sampleRate*Math.PI;f=-2*Math.cos(v)*j;v=-2*Math.cos(v)*u;for(var d=0,s=0,w=0,F=0,E=0;E<h.length;E++){var G=(1*h[E]+v*w+u*F-f*d-j*s)/1*A;F=w;w=h[E];s=d;d=G;h[E]=G}};this.gain=function(f){for(var j=0;j<h.length;j++)h[j]*=f};this.filterClippedDistortion=function(){for(var f=0;f<h.length;++f)h[f]=Math.abs(h[f])<
0.3?h[f]*2:h[f]/2+0.4*(h[f]>0?1:-1)};this.filterSineDistortion=function(f){f=Math.PI*f/2;for(var j=0;j<h.length;j++)h[j]=Math.sin(h[j]*f)};this.filterDecay=function(f){f=f*4;for(var j=0;j<h.length;j++)h[j]*=Math.exp(-j/n*f)};this.filterFrequencySweep=function(f,j,u){j=Math.PI*2*j/sampleRate;u=(Math.PI*2*u/sampleRate-j)/f;j=j;for(var A=0,v=0;v<f;v++){h[v]=Math.sin(A);A+=j;j+=u}};this.draw=function(){var f=this.renderVisual(h.length/5,pdqmus.Wave.VISUAL_HEIGHT_DEFAULT,pdqmus.Wave.VISUAL_TYPE_DEFAULT,
false,"#c53");f.style.border="1px solid #352";f.style.padding="10px";document.body.appendChild(f)};this.addSamples=function(f){for(var j=0;j<h.length;j++)h[j]+=f[j]}};pdqmus.Wave.prototype.play=function(){pdqmus.Sample.createFromUrl(this.getDataUrl()).play()};pdqmus.Wave.VISUAL_TYPE_WAVEFORM="waveform";pdqmus.Wave.VISUAL_TYPE_DEFAULT=pdqmus.Wave.VISUAL_TYPE_WAVEFORM;pdqmus.Wave.VISUAL_WIDTH_DEFAULT=800;pdqmus.Wave.VISUAL_HEIGHT_DEFAULT=200;pdqmus.Wave.OSC_SINE="sine";pdqmus.Wave.OSC_SQUARE="square";
pdqmus.Wave.OSC_SAWTOOTH="sawtooth";pdqmus.Wave.OSC_TRIANGLE="triangle";pdqmus.Wave.OSC_SILENCE="silence";pdqmus.Wave.OSC_NOISE="noise";pdqmus.Wave.OSC_CUSTOM="custom";pdqmus.Wave.OSC_DEFAULT=pdqmus.Wave.OSC_SINE;pdqmus.Wave.PERIODIC_OSCILLATORS=[pdqmus.Wave.OSC_SINE,pdqmus.Wave.OSC_SQUARE,pdqmus.Wave.OSC_TRIANGLE,pdqmus.Wave.OSC_SILENCE,pdqmus.Wave.OSC_SAWTOOTH];pdqmus.Wave.PITCHED_OSCILLATORS=[pdqmus.Wave.OSC_SINE,pdqmus.Wave.OSC_SQUARE,pdqmus.Wave.OSC_TRIANGLE,pdqmus.Wave.OSC_SAWTOOTH];
pdqmus.Envelope=function(a,b,c,g){this.a=a;this.d=b;this.s=c;this.r=g};pdqmus.Envelope.DEFAULT_ENVELOPE=new pdqmus.Envelope(0.05,0.025,0.9,0.025);pdqmus.RenderWaveMessage=function(a,b,c){this.notes=a;this.oscillatorType=b||pdqmus.Wave.OSC_DEFAULT;this.wave=null;this.envelope=c};pdqmus.XmlHttpRequest=function(){};pdqmus.XmlHttpRequest.create=function(){var a=false;try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){try{a=new XMLHttpRequest}catch(g){a=false}}}return a};pdqmus.XmlHttpRequest.READYSTATE_LOADING=1;pdqmus.XmlHttpRequest.READYSTATE_LOADED=2;pdqmus.XmlHttpRequest.READYSTATE_INTERACTIVE=3;pdqmus.XmlHttpRequest.READYSTATE_COMPLETE=4;pdqmus.XmlHttpRequest.HTTP_STATUS_OK=200;
pdqmus.XmlHttpRequest.HTTP_STATUS_CREATED=201;pdqmus.XmlHttpRequest.SUCCESS_STATUSES=[pdqmus.XmlHttpRequest.HTTP_STATUS_OK,pdqmus.XmlHttpRequest.HTTP_STATUS_CREATED];pdqmus.XmlHttpRequest.HEADER_CONTENT_TYPE="Content-Type";pdqmus.XmlHttpRequest.CONTENT_TYPE_JSON="text/json";pdqmus.XmlHttpRequest.CONTENT_TYPE_XML="text/xml";pdqmus.XmlHttpRequest.HEADER_ACCEPT="Accept";pdqmus.XmlHttpRequest.HEADER_REQUESTED_WITH="X-Requested-With";pdqmus.XmlHttpRequest.REQUESTED_WITH_TYPE="XMLHttpRequest";pdqmus.Util=function(){};pdqmus.Util.strFromDword=function(a,b){if(b==pdqmus.Util.BIG_ENDIAN)return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255);return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)};pdqmus.Util.strFromLong=function(a){var b="";for(i=0;i<4;++i){b+=String.fromCharCode(a%256);a=Math.floor(a/256)}return b};pdqmus.Util.strFromWord=function(a,b){if(b==pdqmus.Util.BIG_ENDIAN)return String.fromCharCode(a>>8&255,a&255);return String.fromCharCode(a&255,a>>8&255)};
pdqmus.Util.strFromByte=function(a){return String.fromCharCode(a&255)};pdqmus.Util.strFromVariableInt=function(a){if(!(a>268435455)){if(a<=127)return pdqmus.Util.strFromByte(a);for(var b=a&127;(a>>=7)>0;){b<<=8;b|=128;b+=a&127}for(returnValue="";;){returnValue+=pdqmus.Util.strFromByte(b);if(b&128)b>>=8;else break}return returnValue}};
pdqmus.Util.getPosition=function(a){e=a||window.event;a={x:0,y:0};if(e.pageX||e.pageY){a.x=e.pageX;a.y=e.pageY}else{var b=document.documentElement,c=document.body;a.x=e.clientX+(b.scrollLeft||c.scrollLeft)-(b.clientLeft||0);a.y=e.clientY+(b.scrollTop||c.scrollTop)-(b.clientTop||0)}return a};
pdqmus.Util.getObjectPosition=function(a){var b={x:0,y:0};if(a.offsetParent)for(;;){b.x+=a.offsetLeft;if(!a.offsetParent)break;a=a.offsetParent}else if(a.x)b.x+=a.x;if(a.offsetParent)for(;;){b.y+=a.offsetTop;if(!a.offsetParent)break;b.y=a.offsetParent}else if(a.y)b.y+=a.y;return b};pdqmus.Util.S4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};pdqmus.Util.guid=function(){var a=pdqmus.Util.S4;return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};pdqmus.Util.BIG_ENDIAN="bigEndian";
pdqmus.Util.LITTLE_ENDIAN="littleEndian";pdqmus.Util.NEWLINE="\n";Object.prototype.clone=function(){var a=this instanceof Array?[]:{};for(i in this)if(i!="clone")a[i]=this[i]&&typeof this[i]=="object"?this[i].clone():this[i];return a};
