var pdqmus={};pdqmus.Sound=function(){this.id=null};pdqmus.Sound.prototype.play=function(){throw"not implemented";};pdqmus.Sound.prototype.pause=function(){throw"not implemented";};pdqmus.Sound.prototype.clone=function(){throw"not implemented";};pdqmus.Notation=function(a,b,c,f){this.onset=a;this.duration=b;this.onsetMetric=c;this.durationMetric=f};pdqmus.Notation.prototype.durationFromMetric=function(a){this.duration=60/a*this.durationMetric};pdqmus.Notation.prototype.onsetFromMetric=function(a){this.onset=60/a*this.onsetMetric};pdqmus.Notation.prototype.convertFromMetric=function(a){this.durationFromMetric(a);this.onsetFromMetric(a)};
pdqmus.Notation.prototype.getNearestNotelistDur=function(a){a||(a=60);for(var b=0,c=9999,f=0;f<pdqmus.Note.METRIC_DURATIONS.length;f++){var p=Math.abs(pdqmus.Note.METRIC_DURATIONS[f]-this.duration*(a/60));if(p<c){c=p;b=f}}return b};pdqmus.Notation.sortByDurationDesc=function(a,b){if(a.duration>b.duration)return-1;else if(a.duration<b.duration)return 1;return 0};pdqmus.Notation.sortByOnset=function(a,b){if(a.onset<b.onset)return-1;else if(a.onset>b.onset)return 1;return 0};
pdqmus.Notation.generateNotelist=function(a,b){var c=0;b||(b=60);for(var f="%%Notelist-V2 file='exported from pdqm.us'  partstaves=1 0 startmeas=1"+pdqmus.Util.NEWLINE+"C stf=1 type=3"+pdqmus.Util.NEWLINE+"K stf=1 KS=0 #"+pdqmus.Util.NEWLINE+"M stf=1 '' q="+b+pdqmus.Util.NEWLINE,p=0;p<a.length;p++){var s=a[p],t=Math.round(s.duration*pdqmus.Note.NOTELIST_TICKS_PER_QUARTER);f+="N t="+c+" v=1 npt=1 stf=1 dur="+s.getNearestNotelistDur(b)+" dots=0 nn="+s.noteNum+" acc=0 eAcc=0 pDur="+t*0.9+" vel=75 ...... appear=1"+
pdqmus.Util.NEWLINE;c+=t}f+="/ t="+c+" type=1"+pdqmus.Util.NEWLINE;return f};pdqmus.Notation.NOTELIST_TICKS_PER_QUARTER=480;pdqmus.Notation.NOTELIST_DURATIONS=["longa","breve","whole","half","quarter","eighth","16th","32nd","64th","128th"];pdqmus.Notation.METRIC_DURATIONS=[16,8,4,2,1,0.5,0.25,0.125,0.0625,0.03125];pdqmus.Api=function(){};pdqmus.Api.musicXmlFromNotes=function(a,b,c){b=new pdqmus.AsynchRequest(b,"POST");b.errorCallback=c;a.sort(pdqmus.Notation.sortByOnset);b.requestData=pdqmus.Notation.generateNotelist(a);b.loadXml("/nl2xml")};
pdqmus.Api.soundingStoneRowGen=function(a,b,c){if(a.length!=3)throw"must have 3 numeric pitch classes, no more, no less";for(var f=pdqmus.Api.PROXY_URL+"http://www.soundingstone.net/cgi-bin/rowgen.cgi?mode=json",p=0;p<3;p++)f+="&pitchlist="+a[p];a=new pdqmus.AsynchRequest(b);a.errorCallback=c;a.loadJson(f)};pdqmus.Api.sappHenon=function(a,b){var c=pdqmus.Api.PROXY_URL+"http://henon.sapp.org/cgi-bin/henonsequence",f=new pdqmus.AsynchRequest(a,"POST");f.parseJsonResponse=false;f.errorCallback=b;f.loadJson(c)};
pdqmus.Api.PROXY_URL="/proxy?";pdqmus.Api.formUrl=function(a,b){var c=0,f;for(f in b){a+=c==0?"?":"&";a+=f+"="+b[f];c++}return a};pdqmus.Api.loadJsonp=function(a){var b=document.createElement("script");b.type="text/javascript";b.src=a;document.getElementsByTagName("head")[0].appendChild(b)};pdqmus.AsynchRequest=function(a,b){this.data=this.string=null;this.xmlHttp=pdqmus.XmlHttpRequest.create();this.requestData=this.requestObj=this.errorCallback=null;this.parseJsonResponse=true;this.loadedCallback=a?a:null;this.method=b?b:"GET"};
pdqmus.AsynchRequest.prototype.loadJson=function(a){var b=this;this.xmlHttp.overrideMimeType(XmlHttpRequest.CONTENT_TYPE_JSON);this.xmlHttp.open(this.method,a,true);this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_ACCEPT,pdqmus.XmlHttpRequest.CONTENT_TYPE_JSON);this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_REQUESTED_WITH,pdqmus.XmlHttpRequest.REQUESTED_WITH_TYPE);this.xmlHttp.onreadystatechange=function(){if(b.xmlHttp.readyState==pdqmus.XmlHttpRequest.READYSTATE_COMPLETE){b.string=b.xmlHttp.responseText;
try{if(b.parseJsonResponse)b.data=JSON.parse(b.string);if(XmlHttpRequest.SUCCESS_STATUSES.indexOf(b.xmlHttp.status)>=0){if(b.loadedCallback!=null)b.data?b.loadedCallback(b.data):b.loadedCallback(b.string)}else b.errorCallback!=null&&b.errorCallback()}catch(c){b.errorCallback!=null&&b.errorCallback({error:c,response:b.xmlHttp.responseText,status:b.xmlHttp.status})}}};if(this.requestObj){this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_CONTENT_TYPE,pdqmus.XmlHttpRequest.CONTENT_TYPE_JSON);this.requestData=
JSON.stringify(this.requestObj)}this.xmlHttp.send(this.requestData)};
pdqmus.AsynchRequest.prototype.loadXml=function(a){var b=this;this.xmlHttp.overrideMimeType(XmlHttpRequest.CONTENT_TYPE_XML);this.xmlHttp.open(this.method,a,true);this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_ACCEPT,pdqmus.XmlHttpRequest.CONTENT_TYPE_XML);this.xmlHttp.setRequestHeader(XmlHttpRequest.HEADER_REQUESTED_WITH,pdqmus.XmlHttpRequest.REQUESTED_WITH_TYPE);this.xmlHttp.onreadystatechange=function(){if(b.xmlHttp.readyState==pdqmus.XmlHttpRequest.READYSTATE_COMPLETE){b.string=b.xmlHttp.responseText.replace('<?xml version="1.0" encoding="UTF-8"?>',
"");try{b.data=b.xmlHttp.responseXML;if(XmlHttpRequest.SUCCESS_STATUSES.indexOf(b.xmlHttp.status)>=0){if(b.loadedCallback!=null)b.data?b.loadedCallback(b.data):b.loadedCallback(b.string)}else b.errorCallback!=null&&b.errorCallback()}catch(c){b.errorCallback!=null&&b.errorCallback({error:c,response:b.xmlHttp.responseText,status:b.xmlHttp.status})}}};this.xmlHttp.send(this.requestData)};pdqmus.AsynchRequest.prototype.cancelCallback=function(){this.loadedCallback=null};pdqmus.AudioSequence=function(a,b,c,f){function p(){if(window.Worker){r=new Worker(x+"/wave_render_worker.js");r.onmessage=function(l){j.push(l.data)};r.onerror=function(l){throw l;}}}function s(l){pdqmus.Sample.createFromUrl(l.audioDataUrl).play()}function t(){var l=((new Date).getTime()-q)/1E3;if(j.length>0&&j[0].notes[0].onset<=l-pdqmus.AudioSequence.BUFFER_DELAY){if(!B){v&&v();B=true}if(j.length<=1&&D)C=true;setTimeout(s,1,j.shift())}if(m.length>0&&m[0].onset<=l+A){l=m.shift();for(var F=[l],E=
1;E<m.length;E++)if(m[E].onset==l.onset)F.push(m.shift());else if(m[E].onset>l.onset)break;l=new pdqmus.RenderWaveMessage([l],z,g);r.postMessage(l)}if(m.length<=0)D=true;if(C)y&&y();else o=setTimeout(t,w)}var w=10,o,q,j=[],A=2,u=a.clone(),m,z=b,g=c||null,C=false,B=false,D=false,d=new pdqmus.Wave,h=true,v=null,y=null,x=f||pdqmus.AudioSequence.DEFAULT_WEBWORKER_INCLUDE_PATH,k=this,r=null;this.drawWaveform=function(){return k.getAggregateWave().draw()};this.getDataUrl=function(){return k.getAggregateWave().getDataUrl()};
this.getAggregateWave=function(){if(h){for(var l=0;l<u.length;l++){var F=u[l];d.render(pdqmus.Note.frequencyFromMidiNote(F.noteNum),F.duration,pdqmus.Note.midiVelocityToAmplitude(F.velocity),b);c&&d.envelope(g)}h=false}return d};this.pause=function(){throw"unimplemented";};this.stop=function(){r&&r.terminate();clearTimeout(o);y&&y()};this.play=function(l){if(l){r||p();q=new Date;m=u.clone();m.sort(pdqmus.Notation.sortByOnset);setTimeout(t,1)}else pdqmus.Sample.createFromUrl(k.getDataUrl()).play()};
this.setStartCallback=function(l){v=l};this.setFinishCallback=function(l){y=l}};pdqmus.AudioSequence.BUFFER_DELAY=0.3;pdqmus.AudioSequence.DEFAULT_WEBWORKER_INCLUDE_PATH="/dist";pdqmus.Barline=function(a,b,c){this.onset=a;this.type=b||pdqmus.Barline.TYPE_NORMAL;this.onsetMetric=c;this.duration=0};pdqmus.Barline.prototype=new pdqmus.Notation;pdqmus.Barline.prototype.clone=function(){return new pdqmus.Barline(this.onset,this.type,this.onsetMetric)};pdqmus.Barline.TYPE_NORMAL="normal";var Base64={};Base64.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
Base64.encode=function(a,b){var c,f,p,s,t=[],w="",o,q,j=Base64.code;q=(typeof b=="undefined"?false:b)?Utf8.encode(a):a;o=q.length%3;if(o>0)for(;o++<3;){w+="=";q+="\u0000"}for(o=0;o<q.length;o+=3){c=q.charCodeAt(o);f=q.charCodeAt(o+1);p=q.charCodeAt(o+2);s=c<<16|f<<8|p;c=s>>18&63;f=s>>12&63;p=s>>6&63;s=s&63;t[o/3]=j.charAt(c)+j.charAt(f)+j.charAt(p)+j.charAt(s)}t=t.join("");return t=t.slice(0,t.length-w.length)+w};
Base64.decode=function(a,b){b=typeof b=="undefined"?false:b;var c,f,p,s,t,w=[],o,q=Base64.code;o=b?Utf8.decode(a):a;for(var j=0;j<o.length;j+=4){c=q.indexOf(o.charAt(j));f=q.indexOf(o.charAt(j+1));s=q.indexOf(o.charAt(j+2));t=q.indexOf(o.charAt(j+3));p=c<<18|f<<12|s<<6|t;c=p>>>16&255;f=p>>>8&255;p=p&255;w[j/4]=String.fromCharCode(c,f,p);if(t==64)w[j/4]=String.fromCharCode(c,f);if(s==64)w[j/4]=String.fromCharCode(c)}s=w.join("");return b?Utf8.decode(s):s};var Utf8={};
Utf8.encode=function(a){a=a.replace(/[\u0080-\u07ff]/g,function(b){b=b.charCodeAt(0);return String.fromCharCode(192|b>>6,128|b&63)});return a=a.replace(/[\u0800-\uffff]/g,function(b){b=b.charCodeAt(0);return String.fromCharCode(224|b>>12,128|b>>6&63,128|b&63)})};
Utf8.decode=function(a){a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(b){b=(b.charCodeAt(0)&31)<<6|b.charCodeAt(1)&63;return String.fromCharCode(b)});return a=a.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(b){b=(b.charCodeAt(0)&15)<<12|(b.charCodeAt(1)&63)<<6|b.charCodeAt(2)&63;return String.fromCharCode(b)})};pdqmus.Clef=function(a,b,c,f){this.onset=a;this.sign=b;this.line=c;this.onsetMetric=f;this.duration=0};pdqmus.Clef.prototype=new pdqmus.Notation;pdqmus.Clef.prototype.clone=function(){return new pdqmus.Clef(this.onset,this.sign,this.line,this.onsetMetric)};pdqmus.EchoNest=function(a){this.apiKey=a;this.errorCallback=this.loadedCallback=null;this.method="GET";this.result=null;this.useJsonp=false;var b=this;this.call=function(c,f,p,s){var t=new pdqmus.AsynchRequest(s);if(b.errorCallback)t.errorCallback=b.errorCallback;var w={};w.api_key=this.apiKey;for(var o in p)w[o]=p[o];if(b.useJsonp){w.format="jsonp";w.callback=s;c=pdqmus.Api.formUrl("http://developer.echonest.com/api/v4/"+c+"/"+f,w);pdqmus.Api.loadJsonp(c)}else{w.format="json";c=pdqmus.Api.formUrl(pdqmus.Api.PROXY_URL+
"http://developer.echonest.com/api/v4/"+c+"/"+f,w);t.loadJson(c)}}};pdqmus.GeneralMidi=function(){};
pdqmus.GeneralMidi.PATCHES=["","Acoustic Grand Piano","Bright Acoustic Piano","Electric Grand Piano","Honky-tonk Piano","Electric Piano 1","Electric Piano 2","Harpsichord","Clavinet","Celesta","Glockenspiel","Music Box","Vibraphone","Marimba","Xylophone","Tubular Bells","Dulcimer","Drawbar Organ","Percussive Organ","Rock Organ","Church Organ","Reed Organ","Accordion","Harmonica","Tango Accordion","Acoustic Guitar (nylon)","Acoustic Guitar (steel)","Electric Guitar (jazz)","Electric Guitar (clean)",
"Electric Guitar (muted)","Overdriven Guitar","Distortion Guitar","Guitar harmonics","Acoustic Bass","Electric Bass (finger)","Electric Bass (pick)","Fretless Bass","Slap Bass 1","Slap Bass 2","Synth Bass 1","Synth Bass 2","Violin","Viola","Cello","Contrabass","Tremolo Strings","Pizzicato Strings","Orchestral Harp","Timpani","String Ensemble 1","String Ensemble 2","Synth Strings 1","Synth Strings 2","Choir Aahs","Voice Oohs","Synth Voice","Orchestra Hit","Trumpet","Trombone","Tuba","Muted Trumpet",
"French Horn","Brass Section","Synth Brass 1","Synth Brass 2","Soprano Sax","Alto Sax","Tenor Sax","Baritone Sax","Oboe","English Horn","Bassoon","Clarinet","Piccolo","Flute","Recorder","Pan Flute","Blown Bottle","Shakuhachi","Whistle","Ocarina","Lead 1 (square)","Lead 2 (sawtooth)","Lead 3 (calliope)","Lead 4 (chiff)","Lead 5 (charang)","Lead 6 (voice)","Lead 7 (fifths)","Lead 8 (bass + lead)","Pad 1 (new age)","Pad 2 (warm)","Pad 3 (polysynth)","Pad 4 (choir)","Pad 5 (bowed)","Pad 6 (metallic)",
"Pad 7 (halo)","Pad 8 (sweep)","FX 1 (rain)","FX 2 (soundtrack)","FX 3 (crystal)","FX 4 (atmosphere)","FX 5 (brightness)","FX 6 (goblins)","FX 7 (echoes)","FX 8 (sci-fi)","Sitar","Banjo","Shamisen","Koto","Kalimba","Bag pipe","Fiddle","Shanai","Tinkle Bell","Agogo","Steel Drums","Woodblock","Taiko Drum","Melodic Tom","Synth Drum","Reverse Cymbal","Guitar Fret Noise","Breath Noise","Seashore","Bird Tweet","Telephone Ring","Helicopter","Applause","Gunshot"];pdqmus.KeySignature=function(a,b,c){this.onset=a;this.fifths=b;this.mode=c;this.duration=0};pdqmus.KeySignature.prototype=new pdqmus.Notation;pdqmus.KeySignature.prototype.clone=function(){return new pdqmus.KeySignature(this.onset,this.fifths,this.mode,this.onsetMetric)};pdqmus.KeySignature.MODE_MAJOR="major";pdqmus.KeySignature.MODE_MINOR="minor";pdqmus.Midi=function(a,b){function c(o){for(var q=0,j=0,A="",u=0;u<o.length;u++){j=Math.round(o[u].onset*p/60*f);A+=pdqmus.Util.strFromVariableInt(j-q);A+=o[u].write();q=j}return A}var f=480,p=b||120,s="",t="",w=a||1;this.addTrack=function(o,q,j){q>=0||(q=0);j>=0||(q=0);j=pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(192+q)+pdqmus.Util.strFromByte(j)+pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(4)+pdqmus.Util.strFromByte(25)+"Contrabass Ukulelephonium";for(var A=
[],u=0;u<o.length;u++){var m=o[u];A.push(new pdqmus.MidiNote(u,m.onset,9,q,m.noteNum,m.velocity));A.push(new pdqmus.MidiNote(u,m.onset+m.duration,8,q,m.noteNum,0))}A.sort(pdqmus.Notation.sortByOnset);j+=c(A)+pdqmus.Util.strFromVariableInt(Math.round(f/10))+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(47)+pdqmus.Util.strFromByte(0);t+="MTrk"+pdqmus.Util.strFromDword(j.length,pdqmus.Util.BIG_ENDIAN)+j};this.getDataUrl=function(){return"data:"+pdqmus.Midi.MIME_TYPE+";base64,"+btoa(s+t)};s="MThd"+
pdqmus.Util.strFromDword(6,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromWord(1,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromWord(w+1,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromWord(f,pdqmus.Util.BIG_ENDIAN);(function(){var o=Math.round(6E7/p);o=pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(81)+pdqmus.Util.strFromByte(3)+pdqmus.Util.strFromByte(o>>16)+pdqmus.Util.strFromByte(o>>8)+pdqmus.Util.strFromByte(o)+pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(3)+
pdqmus.Util.strFromByte(26)+"MIDI Created by Javascript"+pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(2)+pdqmus.Util.strFromByte(42)+"Copyleft, Music Hack Day Boston 2010 rules";messages=[];messages.push(new pdqmus.MidiKeySignature(0,0,0));messages.push(new pdqmus.MidiTimeSignature(1,0,4,4));o+=c(messages)+pdqmus.Util.strFromByte(0)+pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(47)+pdqmus.Util.strFromByte(0);t+="MTrk"+pdqmus.Util.strFromDword(o.length,pdqmus.Util.BIG_ENDIAN)+
o})()};pdqmus.Midi.prototype.play=function(){pdqmus.MidiSound.createFromUrl(this.getDataUrl()).play()};pdqmus.MidiMessage=function(a,b,c){this.index=a;this.onset=b;this.statusCode=c};pdqmus.MidiNote=function(a,b,c,f,p,s){this.index=a;this.onset=b;this.statusCode=c;this.channel=f;this.noteNum=p;this.velocity=s};pdqmus.MidiNote.prototype=new pdqmus.MidiMessage;
pdqmus.MidiNote.prototype.write=function(){return pdqmus.Util.strFromByte(this.statusCode*16+this.channel,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromByte(this.noteNum,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromByte(this.velocity,pdqmus.Util.BIG_ENDIAN)};pdqmus.MidiKeySignature=function(a,b,c){this.index=a;this.onset=b;this.statusCode=89;this.fifths=c;this.mode=0};pdqmus.MidiKeySignature.prototype=new pdqmus.MidiMessage;
pdqmus.MidiKeySignature.prototype.write=function(){return pdqmus.Util.strFromByte(255)+pdqmus.Util.strFromByte(this.statusCode)+pdqmus.Util.strFromByte(2)+pdqmus.Util.strFromByte(this.fifths)+pdqmus.Util.strFromByte(this.mode)};pdqmus.MidiTimeSignature=function(a,b,c,f){this.index=a;this.onset=b;this.statusCode=88;this.numerator=c;this.denominator=f;this.pulse=24;this.thirtySecondsPerPulse=8};pdqmus.MidiTimeSignature.prototype=new pdqmus.MidiMessage;
pdqmus.MidiTimeSignature.prototype.write=function(){return pdqmus.Util.strFromByte(255,pdqmus.Util.BIG_ENDIAN)+pdqmus.Util.strFromByte(this.statusCode)+pdqmus.Util.strFromByte(4)+pdqmus.Util.strFromByte(this.numerator)+pdqmus.Util.strFromByte(Math.round(Math.log(this.denominator)/Math.LN2))+pdqmus.Util.strFromByte(this.pulse)+pdqmus.Util.strFromByte(this.thirtySecondsPerPulse)};pdqmus.Midi.MIME_TYPE="audio/mid";pdqmus.MidiSound=function(){this.domRef=document.createElement("embed");this.parentRef=document.getElementsByTagName("body")[0]};pdqmus.MidiSound.prototype=new pdqmus.Sound;pdqmus.MidiSound.prototype.play=function(){this.domRef.hidden="true";this.domRef.autoplay="true";this.domRef.autostart="True";this.domRef.loop="false";this.domRef.volume="100%";this.domRef.style.visibility="hidden";this.parentRef.appendChild(this.domRef)};pdqmus.MidiSound.prototype.pause=function(){this.destroy()};
pdqmus.MidiSound.prototype.destroy=function(){this.domRef.parentNode.removeChild(this.domRef);this.domRef=null};pdqmus.MidiSound.prototype.clone=function(){return pdqmus.MidiSound.createFromUrl(this.url)};pdqmus.MidiSound.createFromUrl=function(a){var b=new pdqmus.MidiSound;b.domRef.src=a;b.domRef.id=pdqmus.Util.guid();return b};pdqmus.Note=function(a,b,c,f,p,s,t){this.onset=a;this.duration=b;this.noteNum=c;this.velocity=f||60;this.onsetMetric=s;this.durationMetric=t;this.isRest=p||false};pdqmus.Note.prototype=new pdqmus.Notation;pdqmus.Note.prototype.clone=function(){return new pdqmus.Note(this.onset,this.duration,this.noteNum,this.velocity,this.isRest)};pdqmus.Note.midiVelocityToAmplitude=function(a){return 1/127*a};pdqmus.Note.midiNoteFromFrequency=function(a){return 12*Math.log2(a/440)+69};
pdqmus.Note.frequencyFromMidiNote=function(a){return pdqmus.Note.CONCERT_A_FREQUENCY/32*Math.pow(2,(a-9)/12)};pdqmus.Note.CONCERT_A_FREQUENCY=440;pdqmus.Note.randomNotes=function(a,b){for(var c=[],f=0,p=0;p<a;p++){var s=Math.random(),t=new pdqmus.Note(f,s*0.9,Math.floor(Math.random()*100)+10,b?Math.floor(Math.random()*40)+10:Math.floor(Math.random()*50)+67);f+=s;c.push(t)}return c};
pdqmus.Note.chromaticSequence=function(a,b,c){var f=0,p=[];for(a=a;a<=b;a++){var s=new pdqmus.Note(f,c,a,60);p.push(s);f+=c}return p};pdqmus.Note.DEFAULT_VELOCITY=60;
pdqmus.Note.MidiFrequencies=[8.1757989156,8.661957218,9.1770239974,10.3008611535,10.3008611535,10.9133822323,11.5623257097,12.2498573744,12.9782717994,13.75,14.5676175474,15.4338531643,16.3515978313,17.3239144361,18.3540479948,19.4454364826,20.6017223071,21.8267644646,23.1246514195,24.4997147489,25.9565435987,27.5,29.1352350949,30.8677063285,32.7031956626,34.6478288721,36.7080959897,38.8908729653,41.2034446141,43.6535289291,46.249302839,48.9994294977,51.9130871975,55,58.2704701898,61.735412657,65.4063913251,
69.2956577442,73.4161919794,77.7817459305,82.4068892282,87.3070578583,92.4986056779,97.9988589954,103.826174395,110,116.5409403795,123.470825314,130.8127826503,138.5913154884,146.8323839587,155.563491861,164.8137784564,174.6141157165,184.9972113558,195.9977179909,207.65234879,220,233.081880759,246.9416506281,261.6255653006,277.1826309769,293.6647679174,311.1269837221,329.6275569129,349.228231433,369.9944227116,391.9954359817,415.3046975799,440,466.1637615181,493.8833012561,523.2511306012,554.3652619537,
587.3295358348,622.2539674442,659.2551138257,698.456462866,739.9888454233,783.9908719635,830.6093951599,880,932.3275230362,987.7666025122,1046.5022612024,1108.7305239075,1174.6590716696,1244.5079348883,1318.5102276515,1396.912925732,1479.9776908465,1567.981743927,1661.2187903198,1760,1864.6550460724,1975.5332050245,2093.0045224048,2217.461047815,2349.3181433393,2489.0158697766,2637.020455303,2793.825851464,2959.9553816931,3135.963487854,3322.4375806396,3520,3729.3100921447,3951.066410049,4186.0090448096,
4434.92209563,4698.6362866785,4978.0317395533,5274.0409106059,5587.6517029281,5919.9107633862,5919.9107633862,6644.8751612791,7040,7458.6201842894,7902.132820098,8372.0180896192,8869.8441912599,9397.272573357,9956.0634791066,10548.0818212118,11175.3034058561,11839.8215267723,12543.853951416];pdqmus.PianoRoll=function(a,b,c,f,p,s){function t(){j.strokeStyle=m;j.moveTo(w,0);j.lineTo(w,q.height);j.stroke();w++;if(w<=o)setTimeout(t,1E3/A);else{g&&q.parentNode.removeChild(q);j.restore()}}this.notes=a;DEFAULT_PITCH_RANGE=127;DEFAULT_UNIT_WIDTH=10;DEFAULT_UNIT_HEIGHT=2;DEFAULT_COLOR="#36c";DEFAULT_CURSOR_COLOR="rgba(200, 100, 50, 0.04)";var w=0,o=0,q=document.createElement("canvas"),j=q.getContext("2d"),A=b||DEFAULT_UNIT_WIDTH,u=c||DEFAULT_UNIT_HEIGHT,m=f||DEFAULT_CURSOR_COLOR,z=p||DEFAULT_PITCH_RANGE,
g=s||false;self=this;this.render=function(C){var B=this.notes[this.notes.length-1];o=(B.onset+B.duration)*A;q.width=o;q.height=u*z;j.strokeStyle=DEFAULT_COLOR;if(C)j.strokeStyle=C;j.lineWidth=u;j.beginPath();for(C=0;C<this.notes.length;C++){var D=this.notes[C];B=D.onset*A;var d=q.height-D.noteNum*u;D=D.duration*A;j.moveTo(B,d);j.lineTo(B+D,d);j.stroke()}j.save();return q};this.play=function(){t()}};
pdqmus.PianoRoll.prototype.draw=function(){var a=this.render();a.style.border="1px solid #352";a.style.padding="10px";document.body.appendChild(a)};pdqmus.Sample=function(){this.domRef=document.createElement("audio");this.domRef.preload=true};pdqmus.Sample.prototype=new pdqmus.Sound;pdqmus.Sample.prototype.play=function(){this.domRef.play()};pdqmus.Sample.prototype.pause=function(){this.domRef.pause()};pdqmus.Sample.prototype.clone=function(){return pdqmus.Sample.createFromUrl(this.url)};pdqmus.Sample.createFromUrl=function(a){var b=new pdqmus.Sample;b.domRef.src=a;b.domRef.id=b.id=pdqmus.Util.guid();return b};pdqmus.Sequencer=function(a,b,c,f){function p(m){m.target.beatOn=!m.target.beatOn;m.target.className=m.target.beatOn?"beatbox beatOn":"beatbox beatOff";if(m.target.isDownbeat)m.target.className+=" downbeat"}var s=pdqmus.Sequencer.SIMPLE_METER,t=a;this.tempo=b||120;this.meterType=c||s;this.numBigBeats=f||4;var w=6E4/this.tempo/this.meterType,o=t.length,q=this.numBigBeats*this.meterType,j=0;this.isPlaying=false;this.isLooping=true;var A;this.allowSampleOverlap=false;var u=this;this.loop=function(){if(j>=
q){j=0;if(!u.isLooping)return}for(var m=0;m<o;m++)for(var z=0;z<q;z++){var g=document.getElementById(m+"_"+z);g.className="beatbox";if(g.isDownbeat)g.className+=" downbeat";g.className+=g.beatOn?" beatOn":" beatOff";if(z==j)g.className+=" beatHighlighted"}for(m=0;m<t.length;m++)if(document.getElementById(m+"_"+j).beatOn)u.allowSampleOverlap?t[m][j].play():t[m][0].play();j++;if(u.isPlaying)A=setTimeout(u.loop,w)};this.render=function(m){for(var z=0;z<o;z++){for(var g=document.createElement("div"),
C=0;C<q;C++){var B=document.createElement("div");B.setAttribute("id",z+"_"+C);B.beatOn=false;B.addEventListener("mousedown",p,"true");if(C>0&&C%this.meterType==0){B.isDownbeat=true;B.className="beatbox beatOff downbeat"}else B.className="beatbox beatOff";g.appendChild(B);g.className="row"}m.appendChild(g)}};this.pauseAllSounds=function(){};this.play=function(){this.isPlaying=true;u.loop()};this.pause=function(){u.isPlaying=false;A&&clearTimeout(A);u.pauseAllSounds()};(function(){for(var m=[],z=0;z<
o;z++){m[z]=[];m[z][0]=t[z];if(u.allowSampleOverlap)for(var g=1;g<q;g++){m[z][g]=t[z].clone();console.log(z,g,m[z][g].id)}}t=m})()};pdqmus.Sequencer.prototype.draw=function(){var a=document.createElement("div");a.className="sequencer";this.render(a);document.body.appendChild(a)};pdqmus.Sequencer.SIMPLE_METER=4;pdqmus.Sequencer.COMPOUND_METER=3;pdqmus.Sequencer.DUPLE_METER=2;pdqmus.Sequencer.SINGLE_METER=1;pdqmus.Tempo=function(a,b,c,f){this.onset=a;this.bpm=b;this.text=c;this.onsetMetric=f;this.duration=0};pdqmus.Tempo.prototype=new pdqmus.Notation;pdqmus.Tempo.prototype.clone=function(){return new pdqmus.Tempo(this.onset,this.bpm,this.text,this.onsetMetric)};pdqmus.TimeSignature=function(a,b,c,f){this.onset=a;this.numerator=b;this.denominator=c;this.onsetMetric=f;this.duration=0};pdqmus.TimeSignature.prototype=new pdqmus.Notation;pdqmus.TimeSignature.prototype.clone=function(){return new pdqmus.KeySignature(this.onset,this.numerator,this.denominator,this.onsetMetric)};pdqmus.Wave=function(){function a(){C=u*A*m/q;B=A*m/q;z=c+pdqmus.Util.strFromDword(g.length+f)+p+s+pdqmus.Util.strFromDword(o)+pdqmus.Util.strFromWord(w)+pdqmus.Util.strFromWord(A)+pdqmus.Util.strFromDword(u)+pdqmus.Util.strFromDword(C)+pdqmus.Util.strFromWord(B)+pdqmus.Util.strFromWord(m)+t+pdqmus.Util.strFromDword(g.length*A*m/q)}function b(){var d="";switch(m){case 8:for(var h=0;h<g.length;h++)d+=String.fromCharCode(Math.round(Math.min(1,Math.max(-1,g[h]))*127+127));break;case 16:for(h=0;h<g.length;h++){var v=
Math.round(Math.min(1,Math.max(-1,g[h]))*32767);if(v<0)v+=j;d+=v}}return d}var c="RIFF",f=36,p="WAVE",s="fmt ",t="data",w=1,o=16,q=8,j=Math.pow(2,22050),A=1,u=22050,m=8,z="",g=[],C=0,B=0,D=[];this.clearData=function(){g=[]};this.setData=function(d){g=d;a()};this.setCycle=function(d){D=d};this.render=function(d,h,v,y){h||(h=1);v||(v=1);if(!y)y=pdqmus.Wave.OSC_DEFAULT;var x=Math.round(1/d*u);pdqmus.Wave.PERIODIC_OSCILLATORS.indexOf(y)>=0||(x*=h*d);var k=[];switch(y){case pdqmus.Wave.OSC_TRIANGLE:k=
x;for(var r=[],l=0;l<k;l++)r.push((Math.abs(l/u%(1/d)*2*d-1)-0.5)*2);k=r;break;case pdqmus.Wave.OSC_SINE:k=x;r=[];for(l=0;l<k;l++)r.push(Math.sin(l/u*2*Math.PI*d));k=r;break;case pdqmus.Wave.OSC_SILENCE:k=x;r=[];for(l=0;l<k;l++)r.push(0);k=r;break;case pdqmus.Wave.OSC_NOISE:k=x;r=[];for(l=0;l<k;l++)r.push((0.5-Math.random())*2);k=r;break;case pdqmus.Wave.OSC_SQUARE:k=x;r=[];for(l=0;l<k;l++)r.push(Math.floor(l/u*2/(1/d)&1)?-1:1);k=r;break;case pdqmus.Wave.OSC_SAWTOOTH:k=x;r=[];for(l=0;l<k;l++)r.push(l/
u%(1/d)*2*d-1);k=r;break;case pdqmus.Wave.OSC_CUSTOM:if(D.length<=0)throw"need cycle data for custom oscillator";}if(v!=1)for(r=0;r<k.length;r++)k[r]*=v;if(pdqmus.Wave.PERIODIC_OSCILLATORS.indexOf(y)>=0)for(r=0;r<Math.round(h*d);r++)g=g.concat(k);else if(y==pdqmus.Wave.OSC_CUSTOM)for(r=0;r<Math.round(x/D.length);r++)g=g.concat(D);else g=g.concat(k);a();D=k};this.getDataUrl=function(d){return d?"data:audio/wav;base64,"+Base64.encode(z+b()):"data:audio/wav;base64,"+btoa(z+b())};this.getData=function(){return g};
this.renderVisual=function(d,h,v,y,x){if(!v)v=pdqmus.Wave.VISUAL_TYPE_DEFAULT;d||(d=100);h||(h=100);y=y?D:g;switch(v){case pdqmus.Wave.VISUAL_TYPE_WAVEFORM:var k=document.createElement("canvas");k.id=pdqmus.Util.guid();k.height=h;k.width=d;v=k.getContext("2d");d=d/y.length;var r=0;h=h/2;v.strokeStyle=x?x:"#000";v.beginPath();v.moveTo(r,h);for(x=0;x<y.length;x++){v.lineTo(r,h*(1-y[x]));r+=d}v.stroke()}return k};this.envelope=function(d){var h=d.a,v=d.d,y=d.s;d=d.r;h*=g.length;v*=g.length;d*=g.length;
for(var x=1-y,k=0;k<h;k++)g[k]*=k/h;for(;k<h+v;k++)g[k]*=(1-(k-h)/v)*x+y;for(;k<g.length-d;k++)g[k]*=y;for(h=k;k<g.length;k++)g[k]*=y*(1-(k-h)/d)};this.filterResonant=function(d,h,v,y){var x=freq*2/sampleRate*Math.PI;d=-2*Math.cos(x)*h;x=-2*Math.cos(x)*v;for(var k=0,r=0,l=0,F=0,E=0;E<g.length;E++){var G=(1*g[E]+x*l+v*F-d*k-h*r)/1*y;F=l;l=g[E];r=k;k=G;g[E]=G}};this.gain=function(d){for(var h=0;h<g.length;h++)g[h]*=d};this.filterClippedDistortion=function(){for(var d=0;d<g.length;++d)g[d]=Math.abs(g[d])<
0.3?g[d]*2:g[d]/2+0.4*(g[d]>0?1:-1)};this.filterSineDistortion=function(d){d=Math.PI*d/2;for(var h=0;h<g.length;h++)g[h]=Math.sin(g[h]*d)};this.filterDecay=function(d){d=d*4;for(var h=0;h<g.length;h++)g[h]*=Math.exp(-h/n*d)};this.filterFrequencySweep=function(d,h,v){h=Math.PI*2*h/sampleRate;v=(Math.PI*2*v/sampleRate-h)/d;h=h;for(var y=0,x=0;x<d;x++){g[x]=Math.sin(y);y+=h;h+=v}};this.draw=function(){var d=this.renderVisual(g.length/5,pdqmus.Wave.VISUAL_HEIGHT_DEFAULT,pdqmus.Wave.VISUAL_TYPE_DEFAULT,
false,"#c53");d.style.border="1px solid #352";d.style.padding="10px";document.body.appendChild(d)};this.addSamples=function(d){for(var h=0;h<g.length;h++)g[h]+=d[h]}};pdqmus.Wave.prototype.play=function(){pdqmus.Sample.createFromUrl(this.getDataUrl()).play()};pdqmus.Wave.VISUAL_TYPE_WAVEFORM="waveform";pdqmus.Wave.VISUAL_TYPE_DEFAULT=pdqmus.Wave.VISUAL_TYPE_WAVEFORM;pdqmus.Wave.VISUAL_WIDTH_DEFAULT=800;pdqmus.Wave.VISUAL_HEIGHT_DEFAULT=200;pdqmus.Wave.OSC_SINE="sine";pdqmus.Wave.OSC_SQUARE="square";
pdqmus.Wave.OSC_SAWTOOTH="sawtooth";pdqmus.Wave.OSC_TRIANGLE="triangle";pdqmus.Wave.OSC_SILENCE="silence";pdqmus.Wave.OSC_NOISE="noise";pdqmus.Wave.OSC_CUSTOM="custom";pdqmus.Wave.OSC_DEFAULT=pdqmus.Wave.OSC_SINE;pdqmus.Wave.PERIODIC_OSCILLATORS=[pdqmus.Wave.OSC_SINE,pdqmus.Wave.OSC_SQUARE,pdqmus.Wave.OSC_TRIANGLE,pdqmus.Wave.OSC_SILENCE,pdqmus.Wave.OSC_SAWTOOTH];pdqmus.Wave.PITCHED_OSCILLATORS=[pdqmus.Wave.OSC_SINE,pdqmus.Wave.OSC_SQUARE,pdqmus.Wave.OSC_TRIANGLE,pdqmus.Wave.OSC_SAWTOOTH];
pdqmus.Envelope=function(a,b,c,f){this.a=a;this.d=b;this.s=c;this.r=f};pdqmus.Envelope.DEFAULT_ENVELOPE=new pdqmus.Envelope(0.05,0.025,0.9,0.025);pdqmus.RenderWaveMessage=function(a,b,c){this.notes=a;this.oscillatorType=b||pdqmus.Wave.OSC_DEFAULT;this.wave=null;this.envelope=c};pdqmus.XmlHttpRequest=function(){};pdqmus.XmlHttpRequest.create=function(){var a=false;try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){try{a=new XMLHttpRequest}catch(f){a=false}}}return a};pdqmus.XmlHttpRequest.READYSTATE_LOADING=1;pdqmus.XmlHttpRequest.READYSTATE_LOADED=2;pdqmus.XmlHttpRequest.READYSTATE_INTERACTIVE=3;pdqmus.XmlHttpRequest.READYSTATE_COMPLETE=4;pdqmus.XmlHttpRequest.HTTP_STATUS_OK=200;
pdqmus.XmlHttpRequest.HTTP_STATUS_CREATED=201;pdqmus.XmlHttpRequest.SUCCESS_STATUSES=[pdqmus.XmlHttpRequest.HTTP_STATUS_OK,pdqmus.XmlHttpRequest.HTTP_STATUS_CREATED];pdqmus.XmlHttpRequest.HEADER_CONTENT_TYPE="Content-Type";pdqmus.XmlHttpRequest.CONTENT_TYPE_JSON="text/json";pdqmus.XmlHttpRequest.CONTENT_TYPE_XML="text/xml";pdqmus.XmlHttpRequest.HEADER_ACCEPT="Accept";pdqmus.XmlHttpRequest.HEADER_REQUESTED_WITH="X-Requested-With";pdqmus.XmlHttpRequest.REQUESTED_WITH_TYPE="XMLHttpRequest";pdqmus.Util=function(){};pdqmus.Util.strFromDword=function(a,b){if(b==pdqmus.Util.BIG_ENDIAN)return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,a&255);return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)};pdqmus.Util.strFromLong=function(a){var b="";for(i=0;i<4;++i){b+=String.fromCharCode(a%256);a=Math.floor(a/256)}return b};pdqmus.Util.strFromWord=function(a,b){if(b==pdqmus.Util.BIG_ENDIAN)return String.fromCharCode(a>>8&255,a&255);return String.fromCharCode(a&255,a>>8&255)};
pdqmus.Util.strFromByte=function(a){return String.fromCharCode(a&255)};pdqmus.Util.strFromVariableInt=function(a){if(!(a>268435455)){if(a<=127)return pdqmus.Util.strFromByte(a);for(var b=a&127;(a>>=7)>0;){b<<=8;b|=128;b+=a&127}for(returnValue="";;){returnValue+=pdqmus.Util.strFromByte(b);if(b&128)b>>=8;else break}return returnValue}};
pdqmus.Util.getPosition=function(a){e=a||window.event;a={x:0,y:0};if(e.pageX||e.pageY){a.x=e.pageX;a.y=e.pageY}else{var b=document.documentElement,c=document.body;a.x=e.clientX+(b.scrollLeft||c.scrollLeft)-(b.clientLeft||0);a.y=e.clientY+(b.scrollTop||c.scrollTop)-(b.clientTop||0)}return a};
pdqmus.Util.getObjectPosition=function(a){var b={x:0,y:0};if(a.offsetParent)for(;;){b.x+=a.offsetLeft;if(!a.offsetParent)break;a=a.offsetParent}else if(a.x)b.x+=a.x;if(a.offsetParent)for(;;){b.y+=a.offsetTop;if(!a.offsetParent)break;b.y=a.offsetParent}else if(a.y)b.y+=a.y;return b};pdqmus.Util.S4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};pdqmus.Util.guid=function(){var a=pdqmus.Util.S4;return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};pdqmus.Util.BIG_ENDIAN="bigEndian";
pdqmus.Util.LITTLE_ENDIAN="littleEndian";pdqmus.Util.NEWLINE="\n";Object.prototype.clone=function(){var a=this instanceof Array?[]:{};for(i in this)if(i!="clone")a[i]=this[i]&&typeof this[i]=="object"?this[i].clone():this[i];return a};
